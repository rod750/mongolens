# mongolens
Prisma inspired database interface for Mongo

## Usage

Creating instance of the server. `Mongolens` class receive the following options:

- uris: array/string of mongo connection strings
- mongooseOptions: see (https://mongoosejs.com/docs/connections.html#options)
- schemaDefs: schema object with a key by model definition, you can use a export like in the example below

```javascript
import { * as schema } from "./schema"

const mongolens = new Mongolens({
  uris: process.env.MONGO_CONNECTION_STRING,
  schemaDefs: schema,
  mongooseOptions: {
    useUnifiedTopology: true,
    useNewUrlParser: true,
    useFindAndModify: false
  }
})

const server = mongolens.createHandler()

server.listen({ port: process.env.PORT || 4000 }).then(({ url }) => {
  console.log(`ðŸš€ Server ready at ${url}`)
})
```

## Creating models

The `modelFactory` helpers receive 3 arguments

- Model name (UpperCamelCase)
- Mongoose schema: see (https://mongoosejs.com/docs/schematypes.html)
- Mongoose schema options: see (https://mongoosejs.com/docs/api/schema.html#schema_Schema)

```javascript
import { modelFactory } from "mongolens"

export const TaskModel = modelFactory("Task", {
  name: { type: String },
  description: { type: String },
  duration: { type: Number },
  order: { type: Number },
  lastStartAt: { type: Date },
  finishedAt: { type: Date },
  elapsedTime: { type: Number, default: 0 },
  status: { type: String, default: "unstarted" }
}, { timestamps: true })
```

## Adding custom resolvers

You can access to `addMutation` and `addQuery` methods from a model instance generated by `modelFactory`

For more information see: https://graphql-compose.github.io/docs/basics/what-is-resolver.html#via-tcaddresolver

```javascript
TaskModel.addMutation({
  type: "Task",
  name: "startById",
  args: {
    _id: {
      type: "MongoID!"
    }
  },
  resolve: async ({args}) => {
    try {
      const task = await TaskModel.model.findByIdAndUpdate(
        args._id,
        { lastStartAt: moment().format(), status: "ongoing" }, 
        { new: true }
      ).exec()

      if(!task)
        throw new Error("Task not found")
      
      return task
    }
    catch(e) {
      throw new Error(e)
    }
  }
})
```
